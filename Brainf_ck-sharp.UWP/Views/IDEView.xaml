<UserControl
    x:Class="Brainf_ck_sharp_UWP.Views.IDEView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:inheritedControls="using:Brainf_ck_sharp_UWP.UserControls.InheritedControls"
    mc:Ignorable="d"
    d:DesignHeight="300"
    d:DesignWidth="400">
    <UserControl.Resources>
        <Storyboard x:Name="CursorAnimation">
            <DoubleAnimation
                Storyboard.TargetName="CursorRectangle"
                Storyboard.TargetProperty="Opacity"
                To="0"
                From="1"
                Duration="0:0:0.5"
                AutoReverse="True"
                RepeatBehavior="Forever"/>
        </Storyboard>
    </UserControl.Resources>

    <!--Root-->
    <Grid Background="#FF1E1E1E">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="20"/>
            <ColumnDefinition Width="36"/>
            <ColumnDefinition 
                Width="*"
                x:Name="CodeColumn"/>
        </Grid.ColumnDefinitions>

        <!--Visual states-->
        <VisualStateManager.VisualStateGroups>
            <VisualStateGroup>
                <VisualState x:Name="Default">
                    <VisualState.Setters>
                        <Setter 
                            Target="CursorBorder.BorderBrush"
                            Value="#20FFFFFF"/>
                    </VisualState.Setters>
                </VisualState>
                <VisualState x:Name="Focused">
                    <VisualState.Setters>
                        <Setter 
                            Target="CursorBorder.BorderBrush"
                            Value="#30FFFFFF"/>
                    </VisualState.Setters>
                </VisualState>
            </VisualStateGroup>
        </VisualStateManager.VisualStateGroups>

        <!--Breakpoints canvas-->
        <Canvas Background="#FF333333"/>

        <!--Line numbers grid-->
        <Canvas Grid.Column="1">
            <Grid
                x:Name="LinesGrid"
                Width="32">
                <TextBlock
                    FontSize="15"
                    Foreground="#FF237CAD"
                    HorizontalAlignment="Right"
                    TextAlignment="Right"
                    Text="0"
                    x:Name="LineBlock"/>
            </Grid>
        </Canvas>

        <!--Code box-->
        <inheritedControls:RichEditBoxWithVerticalOffsetInfo
            Grid.Column="2"
            Style="{StaticResource TransparentEditBox}"
            x:Name="EditBox"
            TextWrapping="NoWrap"
            IsSpellCheckEnabled="False"
            IsTextPredictionEnabled="False"
            ClipboardCopyFormat="PlainText"
            TextChanged="EditBox_OnTextChanged"
            SelectionChanged="EditBox_OnSelectionChanged"
            GotFocus="EditBox_OnGotFocus"
            LostFocus="EditBox_OnLostFocus"
            Margin="0"
            Padding="4,0,0,0">
            <RichEditBox.Header>
                <Grid x:Name="TopMarginGrid"/>
            </RichEditBox.Header>
        </inheritedControls:RichEditBoxWithVerticalOffsetInfo>
        
        <!--Current line cursor-->
        <Canvas 
            Grid.Column="2"
            IsHitTestVisible="False">
            
            <!--Current line highlight-->
            <Border 
                Width="{Binding ElementName=CodeColumn, Path=ActualWidth}"
                VerticalAlignment="Top"
                Height="20"
                BorderThickness="2"
                BorderBrush="#20FFFFFF"
                x:Name="CursorBorder"/>
            
            <!--Virtual cursor-->
            <Rectangle 
                Width="1"
                Height="20"
                Fill="LightGray"
                x:Name="CursorRectangle"/>
        </Canvas>

        <!--Canvas with the column guides-->
        <Canvas
            Grid.Column="2"
            IsHitTestVisible="False"
            x:Name="BracketGuidesCanvas">
            <Canvas.RenderTransform>
                <TranslateTransform x:Name="GuidesTransform"/>
            </Canvas.RenderTransform>
        </Canvas>
    </Grid>
</UserControl>
